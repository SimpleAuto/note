#并发控制,处理并发读或者写时,可以使用共享锁(读锁),排它锁(写锁)

##读锁是共享的,即互不影响,不阻塞
##写锁是排他的,一个写锁会阻塞其他的写锁和读锁.

#锁粒度,表锁和行级锁,根据具体的情况进行取舍

##表锁,是Mysql中最基本的锁策略,并且是开销最小的策略,锁定整张表,只有没有写锁时,其他读取的用户才能获得读锁,读锁之间相互不阻塞.
##行级锁,最大程度地支持并发处理,但会带来最大的锁开销.行级锁只能在存储引擎层实现.

#事务

##本质就是一组原子性的SQL查询,如果数据库引擎能够成功地对数据库应用该组查询的全部语句,那么就执行该组查询,事务内的语句,要么全部执行成功,要么全部执行失败
##ACID:原子性(atomicity),一致性(consistency),隔离性(isolation),持久性(durability)
###原子性:一个事务必须被视为一个不可分割打的最小工作单元,整个事务中的所有操作要么全部提交成功,要么全部回滚失败,对于一个事务来说,不可能只执行一部分的操作
###一致性:数据库总是从一个一致性的状态转换到另外一个一致性的状态,因为事务中的某个操作失败,所以就不会进行提交,所以修改不会保存到数据库中
###隔离性:一个事务所做的修改在最终提交以前,对其他事务是不可见的
###持久性:一旦事务提交,则其所做的修改就会永久保存到数据库中

#隔离级别

##较低级别的隔离通常可以执行更高的并发,系统的开销也更低
##四种隔离级别,Read Uncommitted(未提交读),Read Committed(提交读),Repeatable Read(可重复读),Serializable(可串行化)
###Read Uncommitted:事务中的修改,即使没有提交,对其他事务也都是可见的,事务可以读取未提交的数据,脏读,这个级别会导致很多问题,从性能上说,很少使用
###Read Committed:一个事务从开始直到提交之前,所做的任何修改对其他事务都是不可见的,也叫做不可重复读,因为两次执行同样的查询,可能会得到不一样的结果
###Repeatable Read:解决了脏读的问题,该级别保证了在同一个事务中多次读取同样的记录结果是一样的.但会有幻读的问题.是Mysql的默认事务隔离级别
###Serializable:最高的隔离级别,通过强制事务串行执行,避免幻读问题,会在读取的每一行数据上都加锁,所以可能导致大量的超时和锁争用的问题.

####幻读:指的是当某个事务在读取某个范围内的记录时,另一个事物又在该范围内插入了新的记录,当之前的事务再次读取该范围的记录时,会产生幻行

#死锁

##两个或者多个事务在同一资源上相互占用,并请求锁定对方占用的资源,从而导致恶性循环的现象,当多个事务试图以不同的顺序锁定资源时,就可能会产生死锁,多个事务同时锁定同一个资源时,也会产生死锁.

#事务日志

##可以帮助提高事务的效率,使用事务日志,存储引擎在修改表的数据时只需要修改其内存拷贝,再把该修改行为记录到持久在硬盘上的事务日志中,而不用每次都将修改的数据本身持久到硬盘.

#Mysql中的事务

##自动提交(Auto Commit),Mysql默认采用自动提交模式,如果不是显式的开始一个事务,则每个查询都被当做一个事务执行提交操作, SET AUTOCOMMIT=1来开启自动提交模式,0代表禁止
##设置隔离级别,SET TRANSACTION IOSLATION LEVEL,或者只是改变当前对话的隔离级别,SET SESSION TRANSACTION IOSLATION LEVEL Read Committed;

#在事务中混合使用存储引擎

##Mysql服务器不管理事务,事务是有下层的存储引擎实现的,所以在同一个事务中,使用多种存储引擎是不可靠的

#隐式和显式锁定

##Innodb采用的是两阶段锁定协议(two-phase locking protocol),在事务执行过程中,随时都可以执行锁定,锁只有在执行COMMIT或者ROLLBACK的时候才会释放,并且所有的锁是在同一时刻被释放-->隐式锁定.Innodb会根据隔离级别在需要的时候自动加锁

#Mysql的存储引擎

##Innodb是Mysql的默认事务型引擎,用来处理大量的短期事务,通过间隙锁策略防止幻读的出现,基于聚簇索引建立,对主键查询有很高的性能
##Myisam提供了大量的特性,包括全文索引,压缩,空间函数(GIS)等,不支持事务和行级锁,崩溃后无法安全恢复
##Archive只支持Insert和Select操作,会缓存所有的写并利用zlib的插入的行进行压缩,但是进行Select查询需要执行全表扫描,所以Archive适合日志和数据采集类应用,支持行级锁和专用的缓冲区,不是一个事务型的引擎,而是一个针对高速插入和压缩做了优化的简单引擎
##Blackhole没有实现任何的存储机制,会丢弃所有插入的数据,不做任何保存,但服务器会记录BlackHole日志
##CSV可以将普通的CSV文件(逗号分隔值的文件)作为Mysql的表来处理,但不支持索引,可以作为一种数据交换的机制
##Federated是访问Mysql的一个代理,会创建一个到远程Mysql服务器的客户端连接,并将查询传输到远程服务器执行,然后提取或者发送需要的数据
##Memory适合如果需要快速的访问数据,并且这些数据不会被修改,重启以后丢失也无所谓的数据,因为数据都保存在内存中,支持Hash索引,所以查找快,是表级锁,所以并发写入的性能较低,每行长度固定,不支持Text或者Blob类型的列,Varchar实际存储为char,会导致内存浪费
##Merge是Myisam的变种,已被废弃

#转换表的引擎 ALTER TABLE tablename ENGINE = InnoDb;
