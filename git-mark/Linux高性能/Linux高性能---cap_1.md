# TCP/IP协议族---1

## 学习笔记1

TCP/IP 四层协议系统

图1

- **数据链路层: 实现了网卡接口的网路驱动程序,处理数据在物理媒介传输**

  - ARP协议:Ip地址到机器物理地址,地址解析协议
  - RARP协议:机器物理地址到Ip地址,逆地址解析协议

- **网络层: 实现数据包的选路和转发**

  - IP协议: 逐跳找到目标主机
  - ICMP协议: 用于检测网络连接(差错报文或者查询报文)

图2

- **传输层: 为两台主机上的应用程序提供端到端的通信**

  - TCP协议: 可靠的,面向连接的,基于字节流的服务
  - UDP协议: 不可靠的,无连接的,基于数据报的服务
  - SCTP协议: 可靠的,面向连接的,多宿主连接,基于消息流的服务

### SCTP协议
兼有TCP和UDP优点结合的协议,包括拥塞控制,防止泛滥,防止DDOS攻击,并且是多宿主连接的意思是,这一点,TCP协议是单地址连接,所谓多宿主连接的意思是,SCTP协议支持声明若干IP地址,通知对方本端所有的地址,当当前连接失败的时候,协议可以重新切换到另一个连接,不必再次重新连接.

#### SCTP 建立连接
(1) 服务器必须准备好接受外来的关联.这通常通过调用socket,bind和listen这3个函数来完成,称为被动打开.

(2) 客户通过调用connect或者发送一个隐式打开该关联的消息进行主动打开.这使得客户SCTP发送一个INIT消息(初始化),该消息告诉服务器客户的IP地址清单,初始序列号,用于标识本关联中所有分组的起始标记,客户请求的外出流的数目以及客户能够支持的外来流的数目.

(3) 服务器以一个INIT ACK消息确认客户的INIT消息,其中含有服务器的IP地址清单,初始序列号,起始标记,服务器请求的外出流的数目,服务器能够支持的外来流的数目以及一个状态cookie.状态cookie包含服务器用于确信本关联有效所需的所有状态,它是数字化签名过的,以确保其有效性.

(4) 客户以一个COOKIE ECHO消息回射服务器的状态cookie.除COOKIE ECHO外,该消息可能在同一个分组中还捆绑了用户数据.

(5) 服务器以一个COOKIE ACK消息确认客户回射的cookie是正确的,本关联于是建立.该消息也可能在同一个分组中还捆绑了用户数据.

图3

#### SCTP 断开连接
(1) 主机A发出关闭(SHUTDOWN)块来终止与主机B的关联,主机A进入"SHUTDOWN-PENDING"状态,对应的动作是:不再接受上层应用的数据,只发送队列中剩余的数据,进入"SHUTDOWN-SENT"状态.

(2) 主机B一旦接收到"关闭"块,就进入"SHUTDOWN-RECEIVED"状态,同主机A一样,不再接受上层应用的数据,只发送队列中剩余的数据.

(3) 主机A再次发送"关闭"块,通知主机B所发送的剩余数据已到达,并且重申了关联正在关闭.

(4) 当第二次收到"关闭"块时,主机B发送"确认关闭"块.

(5) 主机A随后发送"关闭结束"块,完成本次关联的关闭.

##### NOTE: SCTP协议在建立连接的过程中,引入了cookie 的概念,保证唯一的cookie来继续建立连接,这样服务器会根据验证唯一的cookie来分配资源,这样就解决了DDOS攻击,减少了使用TCP在防止DDOS攻击时需要验证IP等操作
